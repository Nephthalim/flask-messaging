(this.webpackJsonpreact_messaging=this.webpackJsonpreact_messaging||[]).push([[0],{194:function(e,t,s){},196:function(e,t,s){},204:function(e,t,s){},205:function(e,t,s){},31:function(e,t,s){e.exports={navbar:"LoginForm_navbar__2paba",container:"LoginForm_container__3llB1",logo:"LoginForm_logo__3oRc2",hero:"LoginForm_hero__1Osgo",buttons:"LoginForm_buttons__KRW16",btn:"LoginForm_btn__MfdxB",description:"LoginForm_description__192Vg"}},352:function(e,t,s){},383:function(e,t,s){"use strict";s.r(t);var n=s(0),c=s(72),a=s.n(c),o=(s(194),s(11)),i=s(6),r=s(74),l=s(30),j=s(1),u=function(e){var t=e.conversation,s=e.setChosen,n=e.active;return Object(j.jsxs)("div",{className:n?"row clicked":"row",onClick:function(){return s(t.id)},children:[Object(j.jsx)("div",{className:"initials",children:Object(j.jsx)("p",{children:t.username[0].toUpperCase()})}),Object(j.jsx)("div",{className:"column",children:Object(j.jsx)("h1",{children:t.username.toUpperCase()})})]})},h=(s(196),s(189)),d=function(e){var t=e.setContact,s=e.chatId,c=e.isAuthenticated,a=e.setAuthentication,d=Object(n.useState)(),b=Object(o.a)(d,2),m=b[0],p=b[1],O=Object(n.useState)([]),g=Object(o.a)(O,2),f=g[0],x=g[1],v=Object(n.useState)([]),_=Object(o.a)(v,2),N=_[0],k=_[1],C=Object(i.i)(),y=Object(i.g)(),S=localStorage.getItem("x-token"),w=Object(n.useRef)();return Object(n.useEffect)((function(){fetch("/dashboard/conversations",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-token":S},mode:"cors"}).then((function(e){if(201===e.status||200===e.status)return e.json();409===e.status?(k([]),R.error("Conversation already exists")):y.push("/")})).then((function(e){x(e.conversations)})).catch((function(e){console.log(e),a(!1)})),p(s),w.current.value=""}),[s,c]),Object(j.jsxs)("section",{className:"contact_list",children:[Object(j.jsx)("div",{className:"name",children:Object(j.jsx)("h1",{children:"Contacts"})}),Object(j.jsx)("input",{className:"search",id:"search",type:"text",placeholder:"Search",ref:w,onChange:function(){fetch("/dashboard/search?query="+w.current.value,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-token":S},mode:"cors"}).then((function(e){if(201===e.status||200===e.status)return e.json();409===e.status&&(k([]),R.error("Conversation already exists"))})).then((function(e){k(e.conversations)})).catch((function(e){console.log(e),a(!1)}))},autoComplete:"off"}),Object(j.jsx)("br",{}),Object(j.jsx)("div",{className:"list",children:0===N.length?f.map((function(e){return Object(j.jsx)(l.b,{to:"".concat(C.url,"/").concat(e.id),className:"link",onClick:function(){return t(e.username[0])},children:Object(j.jsx)(u,{conversation:e,setChosen:p,active:e.id==m},e.id)},e.id)})):N.map((function(e){return Object(j.jsx)("div",{onClick:function(){return t=e.id,k([]),w.current.value="",void fetch("/dashboard/conversations",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-token":S},body:JSON.stringify({recipient:t}),mode:"cors"}).then((function(e){if(201===e.status||200===e.status)return e.json();if(409===e.status)throw R.error("Conversation already exists"),p(m.id),"Conversation exists";y.push("/")})).then((function(e){x((function(t){return[].concat(Object(r.a)(t),[e.conversation])})),p(e.conversation.id),y.push("".concat(C.path,"/").concat(e.conversation.id))})).catch((function(e){console.log(e),a(!1)}));var t},children:Object(j.jsx)(u,{conversation:e,setChosen:p,active:!1})},e.id)}))}),Object(j.jsx)("div",{className:"logout",onClick:function(){a(!1),fetch("/auth/logout",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-token":S},mode:"cors"}).then((function(e){if(200===e.status)return e.json()})).then((function(e){localStorage.removeItem("x-token"),y.push("/")})).catch((function(e){console.log(e),y.push("/")}))},children:Object(j.jsx)(h.a,{})})]})},b=(s(204),s(205),function(e){return Object(j.jsx)("li",{className:e.my_message?"my_message message":"their_message message",children:Object(j.jsxs)("div",{className:"card",children:[Object(j.jsxs)("div",{className:"content",children:[e.my_message?null:Object(j.jsx)("div",{className:"initials",children:Object(j.jsx)("p",{children:e.name.toUpperCase()})}),Object(j.jsx)("div",{className:"text_message",children:e.message})]}),Object(j.jsx)("div",{className:"time_sent",children:e.time_sent})]})})}),m=s(188),p=function(e){var t=e.socket,s=e.setChatId,c=e.contact,a=localStorage.getItem("x-token"),l=Object(i.h)().chatId,u=Object(n.useRef)(),h=Object(n.useState)([]),d=Object(o.a)(h,2),p=d[0],O=d[1],g=Object(n.useState)([]),f=Object(o.a)(g,2),x=f[0],v=f[1];t.on("message",(function(e){O((function(t){return[].concat(Object(r.a)(t),[e])}))}));return Object(n.useEffect)((function(){fetch("/chat/messages/"+l,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-token":a}}).then((function(e){return e.json()})).then((function(e){O(e.messages),v(e.user)})).catch((function(e){localStorage.removeItem("x-token")})),t.connect(),t.emit("join",{conversation_id:l}),s(l)}),[l]),Object(j.jsxs)("div",{className:"hero",children:[Object(j.jsx)(m.a,{className:"messages",children:p.map((function(e){return Object(j.jsx)(b,{name:c,message:e.msg,time_sent:e.time_sent,my_message:e.sender===x},e.id)}))}),Object(j.jsx)("form",{onSubmit:function(e){e.preventDefault();var s=u.current.value;console.log(s),t.emit("message",{msg:s,conversation_id:l}),u.current.value=""},children:Object(j.jsx)("input",{className:"msg_input",id:"msg",type:"text",ref:u,placeholder:"Text message",autoComplete:"off"})})]})},O=s.p+"static/media/undraw_Online_chat_re_c4lx.43211c95.svg",g=(s(352),s(187)),f=function(e){var t=e.isAuthenticated,s=e.setAuthentication,c=localStorage.getItem("x-token"),a=Object(g.io)("wss://nephthalims-chat.herokuapp.com",{path:"/socket.io/",extraHeaders:{"x-token":c,"Content-Type":"application/json"}}),r=Object(n.useState)(),l=Object(o.a)(r,2),u=l[0],h=l[1],b=Object(n.useState)(),m=Object(o.a)(b,2),f=m[0],x=m[1],v=Object(i.i)();return Object(n.useEffect)((function(){c&&""!==c&&void 0!==c&&s(!0)}),[]),Object(j.jsxs)("div",{className:"chat",children:[Object(j.jsx)(d,{setContact:x,chatId:u,isAuthenticated:t,setAuthentication:s}),Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{exact:!0,path:v.path,children:Object(j.jsx)("div",{className:"image",children:Object(j.jsx)("img",{src:O})})}),Object(j.jsx)(i.b,{exact:!0,path:"".concat(v.path,"/:chatId"),children:Object(j.jsx)(p,{socket:a,setChatId:h,contact:f})})]})]})},x=s(44),v=s.n(x),_=function(e){var t=e.addUser,s=Object(n.useRef)(),c=Object(n.useRef)(),a=function(e){console.log("Pressed"),e.preventDefault();var n={username:s.current.value.toString(),password:c.current.value.toString()},a=JSON.stringify(n);t(a)};return Object(j.jsx)("div",{className:v.a.body,children:Object(j.jsx)("div",{className:v.a.container,children:Object(j.jsxs)("div",{className:v.a.column,children:[Object(j.jsx)("h1",{children:"Nephthalim's"}),Object(j.jsx)("h2",{children:"Chat"}),Object(j.jsx)("p",{className:v.a.description,children:"This is a messaging application built with Flask"}),Object(j.jsx)("div",{className:v.a.login,children:Object(j.jsxs)("form",{onSubmit:a,children:[Object(j.jsx)("input",{ref:s,type:"username",id:"username",name:"username",placeholder:"Username"}),Object(j.jsx)("input",{ref:c,type:"password",id:"password",name:"password",placeholder:"Password"}),Object(j.jsx)("input",{onClick:a,type:"submit",id:"register-btn",name:"register"})]})})]})})})},N=(s(173),function(e){var t=e.setAuthentication;return Object(j.jsx)(_,{addUser:function(e){fetch("https://nephthalims-chat.herokuapp.com/auth/register",{method:"POST",body:e,headers:{"Content-Type":"application/json","Allow-Type":"application/json"},mode:"no-cors"}).then((function(e){switch(e.status){case 201:return e.json();case 422:R.error("Missing data");break;case 401:R.error("User already exists");break;default:R.error("There seems to be an internal error \ud83d\ude2c It's not me, I promise. Please try again some other time! ")}})).then((function(e){e.access_token&&(localStorage.setItem("x-token",e.access_token),t(!0))})).catch((function(e){console.log(e)}))}})}),k=s.p+"static/media/image.1df5cf55.svg",C=s(31),y=s.n(C),S=function(e){var t=e.loginUser,s=Object(n.useState)(""),c=Object(o.a)(s,2),a=c[0],i=c[1],r=Object(n.useRef)(),u=Object(n.useRef)();return Object(j.jsxs)("section",{className:y.a.hero,children:[Object(j.jsxs)("div",{className:y.a.container,children:[Object(j.jsx)("h1",{children:"Nephthalim's"}),Object(j.jsx)("h2",{children:"Chat"}),Object(j.jsxs)("form",{className:y.a.login,id:"login",children:[Object(j.jsx)("input",{ref:r,type:"username",id:"username",name:"username",placeholder:"Username"}),Object(j.jsx)("input",{ref:u,type:"password",id:"password",name:"password",placeholder:"Password"}),Object(j.jsxs)("div",{className:y.a.buttons,children:[Object(j.jsx)("a",{href:"#",className:y.a.btn,onClick:function(e){e.preventDefault();var s={username:r.current.value,password:u.current.value},n=JSON.stringify(s);t(n,i)},children:"Login"}),Object(j.jsx)("a",{href:"#",className:y.a.btn,children:Object(j.jsx)(l.b,{to:"/register",style:{textDecoration:"none",color:"#ffff"},children:"Register"})})]}),Object(j.jsx)("div",{children:a})]}),Object(j.jsx)("p",{className:y.a.description,children:"This is a messaging application built with Flask"})]}),Object(j.jsx)("div",{className:y.a.image,children:Object(j.jsx)("img",{alt:"",src:k})})]})},w=s(75),T=s.n(w),A=function(){return Object(j.jsxs)("div",{className:T.a.navbar,children:[Object(j.jsxs)("div",{className:T.a.container,children:[Object(j.jsxs)("a",{className:T.a.logo,href:"#",children:["Nephthalim's",Object(j.jsx)("span",{children:"Chat"})]}),Object(j.jsx)("nav",{children:Object(j.jsx)("ul",{children:Object(j.jsx)("li",{children:Object(j.jsx)("a",{href:"https://www.linkedin.com/in/nephthalimabebe",children:"Contact"})})})})]}),"\xa0"]})},I=function(e){var t=e.setAuthentication;return Object(j.jsxs)("div",{children:[Object(j.jsx)(A,{}),Object(j.jsx)(S,{loginUser:function(e,s){fetch("/auth/login",{method:"POST",body:e,headers:{"Access-Control-Allow-Headers":"*","Content-Type":"application/json"},mode:"cors"}).then((function(e){switch(e.status){case 201:return e.json();case 422:R.error("Missing data");break;case 401:R.error("Please check if you are using the right username or password");break;default:R.error("There seems to be an internal error \ud83d\ude2c It's not me, I promise. Please try again some other time! ")}})).then((function(e){e.access_token?(console.log("Logged in"),localStorage.setItem("x-token",e.access_token),R.success(),t(!0)):s(e.msg)})).catch((function(e){console.log(e)}))}})]})},F=s(76),R={success:function(){return F.b.success("\ud83c\udf89 You have successfuly logged in.",{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})},error:function(e){return F.b.error(e,{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}};var E=function(){var e=Object(n.useState)(!1),t=Object(o.a)(e,2),s=t[0],c=t[1],a=localStorage.getItem("token");return Object(n.useEffect)((function(){console.log("Hello"),c(!(!a||""===a||void 0===a))}),[]),Object(j.jsxs)("div",{children:[Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{path:"/",exact:!0,children:s?Object(j.jsx)(i.a,{to:"/chat"}):Object(j.jsx)(I,{setAuthentication:c})}),Object(j.jsx)(i.b,{path:"/register",exact:!0,children:s?Object(j.jsx)(i.a,{to:"/chat"}):Object(j.jsx)(N,{setAuthentication:c})}),Object(j.jsx)(i.b,{path:"/chat",children:Object(j.jsx)(f,{isAuthenticated:s,setAuthentication:c})}),Object(j.jsx)(i.b,{path:"*",children:Object(j.jsx)(i.a,{to:"/"})})]}),Object(j.jsx)(F.a,{position:"bottom-right",autoClose:2500,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})};a.a.render(Object(j.jsx)(l.a,{children:Object(j.jsx)(E,{})}),document.getElementById("root"))},44:function(e,t,s){e.exports={body:"RegisterForm_body__2GQi8",container:"RegisterForm_container__2EwMS",column:"RegisterForm_column__3EEtd",login:"RegisterForm_login__pg8eo","register-btn":"RegisterForm_register-btn__1g8y7"}},75:function(e,t,s){e.exports={navbar:"Nav_navbar__1aE1E",container:"Nav_container__3O35C",logo:"Nav_logo__348g8"}}},[[383,1,2]]]);
//# sourceMappingURL=main.86a9b165.chunk.js.map